# EdgeFlow 빌드 성능 최적화 가이드

사용자가 제안한 **"수정된 노드만 다시 빌드하는 전략"**에 대한 기술적 분석과 현재의 최적화 상태, 그리고 향후 로드맵을 정리한 문서입니다.

---

## 1. 현재 동작 방식: Docker Layer Caching

Docker는 **Layer Caching** 기능을 강력하게 지원합니다.

### Build 시점 (개발자 PC)
- `Dockerfile`의 각 줄(Instruction)은 하나의 레이어가 됩니다.
- 소스 코드가 변경되지 않았다면, Docker는 이전에 빌드해 둔 레이어(Cache)를 재사용합니다.
- 따라서 `edgeflow deploy`를 실행하더라도, **변경된 코드가 없는 노드의 빌드는 1초 이내에 완료**됩니다 (Cached).

### Pull 시점 (워커 노드)
- Kubernetes 노드 또한 이미지를 다운로드할 때 레이어 단위로 확인합니다.
- 베이스 이미지(`python:3.10-slim`)나 의존성 설치 레이어(`RUN uv pip install ...`)가 변경되지 않았다면, 워커 노드는 **이미 가지고 있는 레이어를 재사용**합니다.
- 즉, **변경된 소스 코드 레이어(KB 단위)만 다운로드**하면 되므로 배포 속도가 매우 빠릅니다.

## 2. 제안: Selective Build (선택적 빌드)

### 팁: `no-build` 옵션에 대한 오해와 진실
```bash
edgeflow deploy main.py --no-build
```

- **오해**: "코드를 수정하고 이 옵션을 쓰면 파일만 복사되겠지?" (X)
- **진실**: 이 옵션은 **"이미지를 아예 새로 만들지 않고, 기존에 레지스트리에 있는 이미지를 그대로 쓰겠다"**는 뜻입니다.
- **용도**:
    - 코드 변경 없이 `replicas` 수만 바꾸거나 환경 변수(`main.py`)만 수정해서 다시 배포할 때 유용합니다.
    - 코드를 수정했다면 반드시 빌드를 해야 적용됩니다.
